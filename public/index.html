<!DOCTYPE html>
<html>

<head>
    <title>My Busao</title>
    <link href="/icons/favicon.ico" rel="icon" type="image/x-icon" />
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>

    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>

    <!--Web manifest-->
    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#00ABEE" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        html,
        body,
        .content,
        #map {
            height: 100%;
            width: 100%;
        }

        .content {
            opacity: 0.4;
        }

        .preloader-wrapper {
            position: fixed;
            left: 41.2%;
        }
    </style>
</head>

<body class="valign-wrapper">
    <div class='content'>
        <div id="map"></div>
        <div class="fixed-action-btn click-to-toggle">
            <a class="btn-floating btn-large purple darken-4 waves-effect waves-light">
                <i class="large material-icons">menu</i>
            </a>
            <ul>
                <li><a class="btn-floating blue"><i class="material-icons bus waves-effect waves-light" id="bus">directions_bus</i></a></li>
                <li><a class="btn-floating yellow darken-3"><i class="material-icons waves-effect waves-light" id="user">my_location</i></a></li>
            </ul>
        </div>
    </div>
    <div class="preloader-wrapper big active valign">
        <div class="spinner-layer spinner-blue">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div>
            <div class="gap-patch">
                <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>

        <div class="spinner-layer spinner-red">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div>
            <div class="gap-patch">
                <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>

        <div class="spinner-layer spinner-yellow">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div>
            <div class="gap-patch">
                <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>

        <div class="spinner-layer spinner-green">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div>
            <div class="gap-patch">
                <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>
    <script>
        var map, UserMarker, BusMarker;
        var socket = io();
        var busL = {
            lat: -8.399301,
            lng: -35.056784
          };

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: busL,
                zoom: 15,
                disableDefaultUI: true
            });
        }

        $('#user').click((event) => {
            // Don't show Touch to serach
            event.preventDefault();
            map.setCenter({
                lat: UserMarker.position.lat(),
                lng: UserMarker.position.lng()
            });
        })

        $('#bus').click((event) => {
            event.preventDefault();
            map.setCenter({
                lat: BusMarker.position.lat(),
                lng: BusMarker.position.lng()
            });
        })

        window.onload = function() {
            var startPos;
            var geoSuccess = function(position) {

                var image = 'icons/pin-white64.png';
                var imageBus = 'icons/bus-white64.png';

                UserMarker = new google.maps.Marker({
                    position: {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    },
                    map: map,
                    icon: image
                });

                BusMarker = new google.maps.Marker({
                    position: busL,
                    animation: google.maps.Animation.BOUNCE,
                    map: map,
                    icon: imageBus
                });

                $('.preloader-wrapper').hide('fast');
                $('.content').fadeTo("slow", 1);
            };

            var geoError = function(position) {
                console.log('Error occurred. Error code: ' + error.code);
                // error.code can be:
                //   0: unknown error
                //   1: permission denied
                //   2: position unavailable (error response from location provider)
                //   3: timed out
            };
            navigator.geolocation.watchPosition(geoSuccess, geoError);
        };
    </script>
    <!-- Load Google map -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJQC-wRXNwsY49AgnWLFXBWaFpLkkGu-g&callback=initMap" async defer></script>
</body>

</html>
